define(["jquery","underscore","base.service"],function(e,t,n){"use strict";return{_dte:null,initializeDatatableController:function(e,n){this._dte={view:e||t.deepGet(this.widgets,"enrollmentsTable"),region:n||".data-table"}},fetchTableData:function(t){var r=this;if(!this._setDataTableUrl(t))return;this.spinTable(),e.when(n.doGET(this.dataTableUrl)).done(function(e){r.updateDataTable(e)}).fail(function(){}).always(function(){r.unspinTable()})},updateDataTable:function(e){e=t.result(e,this.tableDataKey)?e[this.tableDataKey]:e,e.updateUrl&&(this.baseUrl=e.updateUrl),!e.columns&&!this._dte.view.model.isNew()?this._dte.view.appendRows(e.data,e.footer):(this.setView(this._dte.region),this._dte.view.model.set(e))},spinTable:function(){var e=this.$el.find(this._dte.region);e.spinner()},unspinTable:function(){this.$el.find(this._dte.region).spinner("hide")},_setDataTableUrl:function(e){if(!this.baseUrl||!t.isObject(e))return!1;var n=this._dropQueryString(this.baseUrl);return this.baseUrl!==n&&t.isEmpty(e.fragment)?this.dataTableUrl=this.baseUrl:this.dataTableUrl=n+e.fragment||"",!0},_dropQueryString:function(e){e=e||"";var t=e.indexOf("?");return t>=0?e.substr(0,t):e}}});