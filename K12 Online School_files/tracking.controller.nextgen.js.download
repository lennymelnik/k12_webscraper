define(["jquery","underscore","postal","./tracking.collection.nextgen"],function(e,t,n,r){"use strict";var i={initialize:function(){this.parseTrackingCodes(),window.alpDataLayer={},n.channel("tracking").subscribe("dataLayerPush",t.bind(this.dataLayerPush,this)),n.channel("tracking").subscribe("bind",t.bind(this.bindEvents,this)),n.channel("tracking").subscribe("bindOneEl",t.bind(this.bindEventsOneEl,this)),n.channel("tracking").subscribe("fireTrackingCode",t.bind(this.fireTrackingCodePostal,this)),n.channel("application").subscribe("logout",t.bind(this._resetTracking,this))},_resetTracking:function(){window.alpDataLayer={}},bindEvents:function(n){var r=this;e("[data-track-click]",n).on("click.trackClick",function(){r.fireTrackingCode(e(this),e(this).data("track-click"))}),e("[data-track-click-delay]",n).on("click.trackClickDelay",function(){var n=e(this);t.delay(function(){r.fireTrackingCode(n,n.data("track-click-delay"))},1e3)})},bindEventsOneEl:function(n){var r=this;e(n).data("track-click")&&e(n).on("click.trackClick",function(){r.fireTrackingCode(e(this),e(this).data("track-click"))}),e(n).data("track-click-delay")&&e("[data-track-click-delay]",n).on("click.trackClickDelay",function(){var n=e(this);t.delay(function(){r.fireTrackingCode(n,n.data("track-click-delay"))},1e3)})},dataLayerPush:function(e){switch(e.id){case GH_CONSTANTS.SESSION.alpObj:t.forIn(e.config,function(e,t){window.alpDataLayer[t]=e});break;case GH_CONSTANTS.SESSION.gtmObj:this.setItemInGTMDataLayer(e.config)}},setItemInGTMDataLayer:function(e){var t=window.dataLayer;t&&t.push(e)},triggerInstantEvent:function(t){n.channel("tracking").publish("fireTrackingCode",{el:e("<div></div>"),val:1,dyn:t})},fireTrackingCode:function(e,t,n){this.trackingCollection.get(t).triggerTracking(e,n)},fireTrackingCodePostal:function(n){var r=t.extend({el:e("<div></div>"),val:0,dyn:{}},n);this.trackingCollection.get(r.id)&&this.trackingCollection.get(r.id).triggerTracking(r.el,n)},parseTrackingCodes:function(){this.trackingCollection=new r}};return i});