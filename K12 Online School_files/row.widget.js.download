define(["underscore","postal","container.view","base.model","../cell/cell.widget"],function(e,t,n,r,i){"use strict";var s=r.extend({parse:function(t){var n=this.get("templates");return e.isArray(n)&&n.length>0&&(t.templates=n),t}});return n.extend({template:"table.row.hbs",rowChannel:null,initialize:function(){n.prototype.initialize.apply(this,arguments),this.model=new s,this.rowChannel=t.channel("channel_"+this.cid),this.subscribeChannel(this.rowChannel,"update",e.bind(this.updateRow,this)),this.subscribeChannel(this.rowChannel,"showSpinner",e.bind(this.showSpinner,this)),this.subscribeChannel(this.rowChannel,"canceled",e.bind(this.cancelEdit,this)),this.subscribeChannel(this.rowChannel,"delete",e.bind(this.removeRow,this)),this.listenTo(this.model,"change",this.render)},afterRender:function(){var t,n,r,s=this.model.get("templates")||[],o=this.model.get("components")||[];this.$el.attr("id","row-"+this.cid).addClass("row"),this.$el.attr("id","row-"+this.cid).removeClass("alternative"),o.length!==s.length&&(s=e.cloneDeep(s),this.$el.attr("id","row-"+this.cid).addClass("alternative"),e.each(o,function(t,n){s[n]=e.extend({},e.pick(s[n],"role"),{responsiveStyle:"col-xs-"+12/o.length})})),e.each(o,function(o,u){t=new i({channel:this.rowChannel}),r="> :nth-child("+(u+1)+")",this.addView(r,t),this.setView(r),n=e.isArray(s)?e.cloneDeep(s[u]):{},n.component=o,t.model.set(n)},this)},updateRow:function(e){this.hideSpinner(),this.model.set(this.model.set(e))},cancelEdit:function(){this.removeRow()},showSpinner:function(){this.$el&&(this.$el.wrapInner('<div class="rowWrapper"></div>'),this.$el.find(".rowWrapper").spinner("show"))},hideSpinner:function(){this.$el&&this.$el.find(".rowWrapper").spinner("hide").children().unwrap()},removeRow:function(){this.dispose(),this.$el.remove(),this.trigger("deleted")}})});