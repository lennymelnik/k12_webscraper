define(["jquery","underscore","container.view","base.model","app/widgets/dropdown/dropdown.widget","app/widgets/badge/badge.widget","i18next","widget.registry.service","session"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=r.extend({parse:function(e){return e.collapsed=this.getNewValue("collapsed",e.collapsed,"")?"collapsed":"",e.type==="InlineCollapsable"&&(e.style=t.addClass(e.style,"inline")),e.title=e.title||e.displayName,e},setPreparser:function(e){this.referenceParser=e}});return n.extend({template:"widget.panel.widget.hbs",events:{"click .expand-icon, .widget-panel-title":"toggleCollapse","click .widget-panel-body a":"_linkClicked"},subviewDefs:{".widget-panel > .tools-menu":{view:i,dataKey:"menu",destroyData:!0,parser:"parseToolsMenu",triggers:{dropdownSelected:"_dropdownSelected"}},".widget-panel > .widget-panel-title":{dynamicView:!0,dataKey:"title"},".widget-panel > .widget-panel-subtitle":{dynamicView:!0,dataKey:"subtitle",parser:"parseSubtitle"}},bodyWidget:null,badge:null,initialize:function(){this.model=new f,n.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",t.bindKey(this,"render"))},afterRender:function(){n.prototype.afterRender.apply(this,arguments);var e=this.model.get("style");if(e)if(a.isNextgen()){var r=e.split(" ");this.$el.addClass(r[0]+"-container")}else this.$el.addClass(e);var i=this.model.getDeep("body.type")||this.model.get("type"),s=this.model.referenceParser||null,o=t.extend(this.model.get("options")||{},{channel:this.channel});!this.bodyWidget&&i&&(this.bodyWidget=u.getInstance(i,o),t.isFunction(s)&&this.bodyWidget.model.setPreparser(s),this.addView(".widget-panel > .widget-panel-body",this.bodyWidget));if(this.bodyWidget){var f=this.model.get("body");f&&(f.emitEmptyMessage=this.model.get("emptyMessage")?!0:!1,f.bodyWidgetCid=this.bodyWidget.cid),t.extend(this.bodyWidget.options,o),this.setView(".widget-panel > .widget-panel-body"),this.subscribe("count"+this.bodyWidget.cid,t.bindKey(this,"updateBadge")),this.subscribe("empty"+this.bodyWidget.cid,t.bindKey(this,"handleBodyRegionContent")),this.listenTo(this.bodyWidget,"empty",t.bindKey(this,"showTheSauce")),this.listenTo(this.bodyWidget,"renderComplete",t.bindKey(this,"trigger","panelRenderComplete")),this.bodyWidget.model.set(f)}},updateBadge:function(t){if(this.model.get("badgeCount")){var n=this.model.get("badgeLabelSingular"),r=this.model.get("badgeLabelPlural");if(this.badge===null){var i=e("<div/>").addClass("panel-badge-container"),o=new s;this.badge=o,this.$el.find("h3.widget-panel-title").append(i),o.el=i,o.setElement(i),o.model.set({count:0,visible:!0,badgeLabelPlural:r,badgeLabelSingular:n})}this.badge.incrementCount(t)}},parseToolsMenu:function(e){return e&&t.extend({buttonStyle:"",labelStyle:"hidden-xs"},e,{caret:!1,standAlone:!0,displayName:null})},parseSubtitle:function(e){e||this.$el.find(".widget-panel > .widget-panel-subtitle").remove()},toggleCollapse:function(t){if(!a.isNextgen()){if(!this._isCollapsibleSize())return;var n=this.$el.find(".widget-panel-title .link-text"),r=this.model.getDeep("title.displayName")||n.text(),i;e(t.target).closest(".widget-panel").toggleClass("collapsed").hasClass("collapsed")?(this.bodyWidget.trigger("hide"),i=this.model.get("title_show"),n.text(i?o.t(i):r)):(this.bodyWidget.trigger("show"),i=this.model.get("title_hide"),n.text(i?o.t(i):r))}},_isCollapsibleSize:function(){var e=this.model.get("type")==="InlineCollapsable";return e||window.innerWidth<=GH_CONSTANTS.RESPONSIVE.MAX.XS},_dropdownSelected:function(e){this.trigger("dropdownSelected",e)},_linkClicked:function(e){this.trigger("linkClicked",e)},showTheSauce:function(){var e=this.model.get("emptyMessage")||"THIS SPACE INTENTIONALLY LEFT BLANK.";this.renderNoContentMessage(e,this.bodyWidget.$el)}},{parser:function(e,t){return function(n){return n=n||{},n.type=e,{title:{type:"NamedComponent",displayName:n.displayName},subtitle:{type:"NamedComponent",displayName:n.label},menu:n.menu,body:n,collapsed:t,options:n.options||{}}}},insertSpinnable:function(e){return e?(e.spinnable=!0,e):e}})});