define(["jquery","underscore","backbone","base.view","base.service","session","i18next"],function(e,t,n,r,i,s,o){"use strict";var u=r.extend({template:"background.chooser.hbs",events:{"click #drawer-image":"toggleDrawer","click #drawer-arrow a":"toggleDrawer","click #drawer-btn #thumbs li a":"changeBackground"},initialize:function(){r.prototype.initialize.apply(this,arguments),this.model=new n.Model,this.listenTo(this.model,"change",t.bindKey(this,"render"))},toggleDrawer:function(t){var n=e("#drawer-btn");t.preventDefault(),n.toggleClass("open");if(n.hasClass("open")){var r=e("#thumbs>li>a").first();r.focus()}},changeBackground:function(t){t.preventDefault();var n=e(t.currentTarget);this.setSelectedBackground(n)},setSelectedBackground:function(t){if(t.hasClass("selected")||!this.enabled)return;var n=this.model.get("inputs")[0].options[t.data("value")-1];e("#thumbs li a.selected").removeClass("selected"),t.addClass("selected"),this.sendSelectionToBE(n.value),this.setUI(n.config)},setUI:function(e){this.setDrawerImage(e.thumb),this.setWallpaper(e.img),e.creditPerson&&this.setCredits(e.creditPerson,e.creditSchool)},setDrawerImage:function(t){e("#drawer-image a img").attr("src",t)},sendSelectionToBE:function(t){var n=this,r={background:t.toString()};e.when(i.doREQUEST(n.method,n.model.get("url"),JSON.stringify(r),{})).done(function(){debug.log("background chooser has sent value.")})},setWallpaper:function(t){e("#wallpaper").attr("style","background: url('"+t+"'); background-size: cover; background-position: center center;")},setCredits:function(t,n){var r=e("<div></div>").addClass("credit-photo"),i=e("<div></div>").addClass("credit-courtesy"),s=e("<div></div>").addClass("credit-name"),u=e("<div></div>").addClass("credit-school");i.append(o.t("Nextgen.background.credits")),s.append(t),u.append(n),r.append(i).append(s).append(u),e("#wallpaper").empty().append(r)},renderHelp:function(){},afterRender:function(){var n,r,i,s=this.model.get("inputs"),o=this.model.get("config");this.method=o.post?"POST":"GET",this.enabled=s[0].enabled,s[0].enabled===!1&&e("#thumbs li a").addClass("disabled"),n=t.findIndex(s[0].options,{"default":!0}),r=t.findIndex(s[0].options,{selected:!0}),i=r!==-1?s[0].options[r]:s[0].options[n],i&&this.setUI(i.config)}});return u});