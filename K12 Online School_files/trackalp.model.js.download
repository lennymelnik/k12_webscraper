define(["underscore","jquery","backbone","postal","base.service"],function(e,t,n,r,i){"use strict";var s=n.Model.extend({trackingDataPrepend:"trackAttr",defaults:{id:null,name:null,parameters:[],global:!1,logout:!1},globalVars:{trackAttrPageurl:"pageURL",trackAttrPagetitle:"pageTitle"},initialize:function(t){var n=this;this.alpEndpoint=GLOBALS.ENVIRONMENT.endpoints.alp||null,this.set("name",t.eventName),this.set("pageTitle",t.pageTitle),this.set("pageURL",t.pageURL),t.ga&&this.set("ga",t.ga),e.each(t,function(n,r){e.isObject(n)||(t.alp[r]=n)}),this.set("parameters",t.alp),e.each(t,function(e,t){n.set(t,e)})},parseParameters:function(n,r){var i={},s=t(n),o=this;return e.extend(i,this.get("parameters")),r&&r.data&&e.each(r.data,function(e){i[e.key]=e.value}),e.each(s.data(),function(t,n){var r=e.startsWith(n,o.trackingDataPrepend);if(r!==null&&r!==!1){var s=o.globalVars[n];s&&(i[s]=t)}}),i},triggerTrack:function(t,n){var r=this.parseParameters(t,n),s=e.extend(r,window.alpDataLayer),o=JSON.stringify(s),u=e.extend(s,this.get("ga"));this.gtmPush(u),this.alpEndpoint&&i.doPOST(this.alpEndpoint,o)},gtmPush:function(e){window.dataLayer&&(e.eventLabel=e.pageTitle,e.event="ghEvent",debug.log("Google Tag Manager:"),debug.log(e),debug.log("pushing data to dataLayer... see console.log(window.dataLayer);"),window.dataLayer.push(e))}});return s});